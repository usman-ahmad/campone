<% content_for(:tab_nav) do %>
    <%= render 'shared/tab_nav', project: @project, active: 'todos' %>
<% end %>

<%= form_tag project_tasks_path(@project), :method => 'get' do %>
    <div class="form-group col-md-4 pull-right">
      <div class="input-group">
        <%= text_field_tag :search_text, params[:search_text], placeholder: "Search Tasks", class: "form-control" %>
        <div class="input-group-addon"><i class="fa fa-search"></i></div>
      </div>
    </div>
<% end %>

<div class="page-header">
  <%= link_to new_project_task_path, class: 'btn btn-primary' do %>
      <span class="glyphicon glyphicon-plus"></span>
      New Task
  <% end %>
  <%= link_to project_tasks_path(@project, format: "csv"), class: 'btn btn-primary' do %>
      <span class="glyphicon glyphicon-export"></span>
      Export CSV
  <% end %>
  <%= link_to new_import_project_tasks_path(@project), class: 'btn btn-primary' do %>
      <span class="glyphicon glyphicon-import"></span>
      Import CSV
  <% end %>
  <% include_completed = cookies[:include_completed] == 'true' %>
  <%= link_to project_tasks_path(@project, include_completed: !include_completed ), class: "btn btn-#{include_completed ? 'success' :'info'}" do %>
    <%= include_completed  ? 'Hide' : 'Show' %> Completed Tasks
  <% end %>
  <h1>Listing Tasks</h1>
</div>

<div class="col-md-12">
  <div class="col-md-9">
    <h3 class="heading-3">To-Do list</h3>
    <ul class="sortable" id="tasks" data-update-url="<%= sort_project_tasks_url %>">
      <% @tasks.each do |task| %>
        <li id="task_<%= task.id %>" class="ui-state-default custom-ui-state anchor-container" data-href="<%= project_task_path(@project, task) %>">
          <span class="ui-icon ui-icon-grip-dotted-vertical custom-ui-drag"></span>

          <p class="todo-content">
            <span><%= task.title %></span>
              <span class="tag-holder">
                  <span class="tag">Priority: <%= task.priority %></span>
                  <% if task.due_at.present? %>
                    <span class="tag"> Due Date: <%= task.due_at %></span>
                  <%end%>
                    <span class="tag">Comment (<%= task.comments.count %>)</span>
                  <% if task.creator.present? %>
                    <span class="tag">Created By (<%= task.creator.name %>)</span>
                  <%end%>
                  <%= content_tag(:span,"Progress: #{task.progress.humanize}", class:'tag' ) %>
              </span>

          <div class="pull-right">
            <a href="<%= edit_project_task_path(@project, task) %>" title="Edit To-Do"><i class="fa fa-pencil customTodo-icon"></i></a>
            <%= link_to project_task_path(@project, task), method: :delete, data: {confirm: 'Are you sure?'} do %>
                <i class="fa fa-trash-o customTodo-icon"></i>
            <% end %>
          </div>
          </p>
        </li>
      <% end %>
    </ul>
  </div>
</div>
